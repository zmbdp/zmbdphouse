worker_processes auto;
worker_cpu_affinity auto;
# 最大打开文件数，可设置为系统优化后的ulimit -HSn的结果，调整系统文件描述和这个问题有相同之处
# 需要调整系统打开文件数量
worker_rlimit_nofile 65535;

events {
    use epoll;
    worker_connections  10000;
    multi_accept on;
}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;
    client_max_body_size 10m;

     upstream zmbdpgateway {
         server 你的内网ip:10030 ;
         keepalive 1000;
     }



    # 服务端
    server {
        listen       80;
        server_name  "";
        client_max_body_size 100M;

        location / {
            root   /data/zmbdphouse/web/dist;
            try_files $uri $uri/ /index.html;
            index  index.html index.htm;
	        #允许跨域请求的域，* 代表所有
		    add_header 'Access-Control-Allow-Origin' *;
		    #允许请求的header
		    add_header 'Access-Control-Allow-Headers' *;
		    #允许带上cookie请求
		    add_header 'Access-Control-Allow-Credentials' 'true';
		    #允许请求的方法，比如 GET,POST,PUT,DELETE
		    add_header 'Access-Control-Allow-Methods' *;
        }

         location ~* ^\/(admin\/|file\/|portal\/) {
             proxy_http_version 1.1;
             proxy_set_header Connection "";
             add_header Cache-Control no-store;
             add_header Pragma  no-cache;
             proxy_set_header Host $http_host;
             proxy_set_header X-Real-IP $remote_addr;
             proxy_set_header REMOTE-HOST $remote_addr;
             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
             proxy_pass http://zmbdpgateway;
             proxy_connect_timeout    300s;
             proxy_read_timeout       300s;
             proxy_send_timeout       300s;
         }
    }
}
