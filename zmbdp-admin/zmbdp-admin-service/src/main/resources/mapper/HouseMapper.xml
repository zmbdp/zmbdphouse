<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zmbdp.admin.service.house.mapper.HouseMapper">


    <select id="selectCountWithStatus"
            parameterType="com.zmbdp.admin.service.house.domain.dto.HouseListReqDTO"
            resultType="java.lang.Long">
        SELECT COUNT(1)
        FROM
        house h
        LEFT JOIN house_status hs ON h.id = hs.house_id
        <where>
            <if test="houseId != null">
                AND h.id = #{houseId}
            </if>
            <if test="cityId != null">
                AND h.city_id = #{cityId}
            </if>
            <if test="rentType != null and rentType != ''">
                AND h.rent_type = #{rentType}
            </if>
            <if test="title != null and title != ''">
                AND h.title LIKE CONCAT('%', #{title}, '%')
            </if>
            <if test="communityName != null and communityName != ''">
                AND h.community_name LIKE CONCAT('%', #{communityName}, '%')
            </if>
            <if test="status != null and status != ''">
                AND hs.status = #{status}
            </if>
        </where>
    </select>

    <select id="selectPageWithStatus"
            parameterType="com.zmbdp.admin.service.house.domain.dto.HouseListReqDTO"
            resultType="com.zmbdp.admin.service.house.domain.dto.HouseDescDTO">
        SELECT
        h.*,
        h.id AS houseId,
        hs.status AS status,
        hs.rent_time_code AS rentTimeCode
        FROM
        house h
        LEFT JOIN house_status hs ON h.id = hs.house_id
        <where>
            <if test="houseId != null">
                AND h.id = #{houseId}
            </if>
            <if test="cityId != null">
                AND h.city_id = #{cityId}
            </if>
            <if test="rentType != null and rentType != ''">
                AND h.rent_type = #{rentType}
            </if>
            <if test="title != null and title != ''">
                AND h.title LIKE CONCAT('%', #{title}, '%')
            </if>
            <if test="communityName != null and communityName != ''">
                AND h.community_name LIKE CONCAT('%', #{communityName}, '%')
            </if>
            <if test="status != null and status != ''">
                AND hs.status = #{status}
            </if>
        </where>
        ORDER BY h.id DESC
        LIMIT #{offset}, #{pageSize}
    </select>
<!--    获取所有房源的 id-->
    <select id="selectHouseIds" resultType="java.lang.Long">
        select id from house
    </select>
</mapper>